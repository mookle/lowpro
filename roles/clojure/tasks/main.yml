---

- name: install via package manager
  include_tasks: package_manager.yml
  vars:
    packages: [ leiningen ]
  when: ansible_os_family == "Darwin" or ansible_os_family == "Archlinux"

- name: install via package manager
  include_tasks: package_manager.yml
  vars:
    packages: [ leiningen-clojure ]
  when: ansible_os_family == "Debian"

- name: ensure config directory exists
  file:
    path: "{{ lein_config_dir }}"
    state: directory
  tags: [ config ]

- name: copy config file
  copy:
    src: files/profiles.clj
    dest: "{{ lein_config_dir }}/profiles.clj"
  tags: [ config ]

- name: copy neovim filetype config
  copy:
    src: files/ftplugin.vim
    dest: "{{ ansible_env.HOME }}/.config/nvim/ftplugin/clojure.vim"
  tags: [ config, neovim ]

- name: add plugin to init.vim
  blockinfile:
    dest: "{{ ansible_env.HOME }}/.config/nvim/init.vim"
    marker: "\" {mark} ANSIBLE BLOCK: Clojure integration"
    block: |
      Plug 'clojure-vim/clojure.vim'
      Plug 'tpope/vim-sexp-mappings-for-regular-people'
      Plug 'guns/vim-sexp'
    insertbefore: "call plug#end()"
  tags: [ config, neovim ]
